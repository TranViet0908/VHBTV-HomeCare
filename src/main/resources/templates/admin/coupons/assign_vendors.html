<!-- src/main/resources/templates/admin/coupons/assign_vendors.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"><title>Gán vendor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
<div class="flex">
  <div th:replace="/admin/fragments/sidebar :: sidebar"></div>
  <div class="flex-1 min-h-screen ml-64">
    <div th:replace="/admin/fragments/header :: header"></div>

    <main class="p-6" th:object="${coupon}">
      <div class="mb-6 flex items-center justify-between">
        <h1 class="text-2xl font-bold">Gán vendor — <span class="text-blue-700" th:text="*{code}">CODE</span></h1>
        <a class="text-blue-600 hover:underline" th:href="@{'/admin/coupons/' + *{id} + '/edit'}">Quay lại sửa mã</a>
      </div>

      <div class="bg-white rounded-xl border p-4">
        <form class="grid grid-cols-1 md:grid-cols-3 gap-3"
              th:action="@{'/admin/coupons/' + *{id} + '/vendors'}" method="post">
          <div class="md:col-span-2 space-y-2">
            <label class="block text-sm font-medium">Chọn vendor</label>
            <input id="filterVendor" type="text" class="w-full border rounded px-3 py-2"
                   placeholder="Lọc nhanh theo tên/email (client-side)">
            <select id="vendorSelect" name="vendorId" class="px-3 py-2 border rounded-lg w-full" required size="8">
              <option th:each="v : ${vendors}"
                      th:value="${v.id}"
                      th:data-key="${(v.username!=null?v.username:'') + ' ' + v.email}"
                      th:text="${'#' + v.id + ' • ' + (v.username!=null?v.username:'vendor') + ' • ' + v.email}">
              </option>
            </select>
          </div>
          <div class="flex items-end">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg" type="submit">Thêm vào whitelist</button>
          </div>
        </form>
      </div>

      <div class="bg-white rounded-xl border mt-6 overflow-hidden">
        <table class="w-full text-sm">
          <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left">Vendor</th>
            <th class="px-4 py-2 text-right">Thao tác</th>
          </tr>
          </thead>
          <tbody class="divide-y" th:if="${items!=null and !#lists.isEmpty(items)}">
          <tr th:each="it : ${items}">
            <td class="px-4 py-2" th:text="${'#' + it.vendor.id}">#101</td>
            <td class="px-4 py-2 text-right">
              <form th:action="@{'/admin/coupons/' + ${coupon.id} + '/vendors/remove'}" method="post" class="inline">
                <input type="hidden" name="vendorId" th:value="${it.vendor.id}">
                <button class="px-3 py-1 border rounded hover:bg-gray-50">Gỡ</button>
              </form>
            </td>
          </tr>
          </tbody>
          <tbody th:if="${items==null or #lists.isEmpty(items)}">
          <tr><td class="px-4 py-6 text-center text-gray-500" colspan="2">Chưa gán vendor nào</td></tr>
          </tbody>
        </table>
      </div>
    </main>

    <div th:replace="/admin/fragments/footer :: footer"></div>
  </div>
</div>

<script>
  const filterVendor = document.getElementById('filterVendor');
  const vendorSelect = document.getElementById('vendorSelect');
  filterVendor?.addEventListener('input', () => {
    const q = filterVendor.value.trim().toLowerCase();
    Array.from(vendorSelect.options).forEach(opt => {
      const key = (opt.getAttribute('data-key') || '').toLowerCase();
      opt.hidden = q && !key.includes(q);
    });
  });
</script>
</body>
</html>
