<!-- templates/admin/coupons/redemptions.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Lượt sử dụng mã</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
<div class="flex">
  <div th:replace="/admin/fragments/sidebar :: sidebar"></div>
  <div class="flex-1 min-h-screen ml-64">
    <div th:replace="/admin/fragments/header :: header"></div>

    <main class="p-6">
      <div class="mb-6 flex items-center justify-between">
        <h1 class="text-3xl font-bold text-gray-800">Lượt sử dụng mã</h1>
      </div>

      <form class="bg-white rounded-lg shadow p-4 mb-4 grid md:grid-cols-4 gap-3" method="get" th:action="@{/admin/coupons/redemptions}">
        <input class="border rounded px-3 py-2" name="couponId" placeholder="Lọc theo Coupon ID" th:value="${couponId}">
        <button class="px-3 py-2 bg-gray-800 text-white rounded hover:bg-black" type="submit">Lọc</button>
      </form>

      <div class="bg-white rounded-lg shadow overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="text-left px-4 py-2">Coupon</th>
            <th class="text-left px-4 py-2">User</th>
            <th class="text-left px-4 py-2">Dịch vụ</th>
            <th class="text-right px-4 py-2">Giảm</th>
            <th class="text-left px-4 py-2">Thời gian</th>
          </tr>
          </thead>
          <tbody class="divide-y" th:if="${data!=null}">
          <tr th:each="r : ${data}">
            <td class="px-4 py-2" th:text="${r.coupon!=null? r.coupon.code : ('#'+r.coupon.id)}">COUPON</td>
            <td class="px-4 py-2" th:text="${r.user!=null? r.user.username : ''}">USER</td>
            <td class="px-4 py-2" th:text="${r.vendorService!=null? r.vendorService.name : ''}">SERVICE</td>
            <td class="px-4 py-2 text-right" th:text="${#numbers.formatDecimal(r.amountDiscounted,1,2)}">0</td>
            <td class="px-4 py-2" th:text="${#temporals.format(r.redeemedAt,'dd/MM/yyyy HH:mm')}">..</td>
          </tr>
          </tbody>
          <tbody th:if="${data==null or #lists.isEmpty(data.content)}">
          <tr><td class="px-4 py-6 text-center text-gray-500" colspan="5">Chưa có lượt sử dụng</td></tr>
          </tbody>
        </table>
      </div>

      <div class="mt-4 flex items-center justify-between" th:if="${data!=null}">
        <div class="text-sm text-gray-600"
             th:text="'Trang ' + ${data.number+1} + ' / ' + ${data.totalPages} + ', Tổng: ' + ${data.totalElements}">
        </div>
        <div class="flex gap-2">
          <a th:if="${!data.first}" th:href="@{/admin/coupons/redemptions(page=${data.number-1},size=${data.size},couponId=${couponId})}"
             class="px-3 py-2 bg-white border rounded hover:bg-gray-50">Trước</a>
          <a th:if="${!data.last}" th:href="@{/admin/coupons/redemptions(page=${data.number+1},size=${data.size},couponId=${couponId})}"
             class="px-3 py-2 bg-white border rounded hover:bg-gray-50">Sau</a>
        </div>
      </div>
    </main>

    <div th:replace="/admin/fragments/footer :: footer"></div>
  </div>
</div>
</body>
</html>
