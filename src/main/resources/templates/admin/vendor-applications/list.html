<!-- src/main/resources/templates/admin/vendor-applications/list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Duyệt hồ sơ Vendor - VHBTV HomeCare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
<div class="flex">
    <!-- Sidebar -->
    <div th:replace="/admin/fragments/sidebar :: sidebar"></div>

    <div class="flex-1 min-h-screen ml-64">
        <!-- Header -->
        <div th:replace="/admin/fragments/header :: header"></div>

        <!-- Main -->
        <main class="p-6">
            <!-- Title + back -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Duyệt hồ sơ vendor</h1>
                        <p class="text-gray-600">Danh sách đơn xin làm vendor và thao tác phê duyệt</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a th:href="@{/admin/dashboard}" class="inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                            <i class="fas fa-arrow-left mr-2"></i>Về trang chủ
                        </a>
                    </div>
                </div>
            </div>

            <!-- Alert -->
            <div th:if="${msg != null}" class="mb-4">
                <div th:if="${msg == 'approved'}" class="p-3 rounded-lg bg-green-50 text-green-700 border border-green-200">
                    <i class="fas fa-check mr-2"></i>Đã phê duyệt.
                </div>
                <div th:if="${msg == 'rejected'}" class="p-3 rounded-lg bg-yellow-50 text-yellow-700 border border-yellow-200">
                    <i class="fas fa-ban mr-2"></i>Đã từ chối.
                </div>
                <div th:if="${msg == 'deleted'}" class="p-3 rounded-lg bg-red-50 text-red-700 border border-red-200">
                    <i class="fas fa-trash mr-2"></i>Đã xóa đơn.
                </div>
            </div>
            <div th:if="${err != null}" class="mb-4">
                <div class="p-3 rounded-lg bg-red-50 text-red-700 border border-red-200">
                    <i class="fas fa-triangle-exclamation mr-2"></i>Thao tác thất bại.
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                <form class="flex items-center gap-4" method="get" th:action="@{/admin/vendor-applications}">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">Trạng thái</label>
                        <select name="status" class="border border-gray-300 rounded-lg px-3 py-2">
                            <option th:value="${null}" th:selected="${statusFilter == null}">Tất cả</option>
                            <option value="PENDING" th:selected="${statusFilter == T(Project.HouseService.Entity.VendorApplication.Status).PENDING}">PENDING</option>
                            <option value="APPROVED" th:selected="${statusFilter == T(Project.HouseService.Entity.VendorApplication.Status).APPROVED}">APPROVED</option>
                            <option value="REJECTED" th:selected="${statusFilter == T(Project.HouseService.Entity.VendorApplication.Status).REJECTED}">REJECTED</option>
                        </select>
                    </div>
                    <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                        <i class="fas fa-filter mr-2"></i>Lọc
                    </button>
                </form>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">User ID</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Tên hiển thị</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Họ tên</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Liên hệ</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Khu vực</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Kinh nghiệm</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Trạng thái</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ngày tạo</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Thao tác</th>
                        </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                        <tr th:each="a : ${apps}" class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4 text-sm font-medium text-gray-900" th:text="${a.id}">1</td>
                            <td class="px-6 py-4 text-sm text-gray-700" th:text="${a.userIdFk}">10</td>
                            <td class="px-6 py-4 text-sm text-gray-900" th:text="${a.displayName}">Thợ Điện Minh</td>
                            <td class="px-6 py-4 text-sm text-gray-700" th:text="${a.fullName}">Nguyễn Văn A</td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div th:text="${a.email}">email@example.com</div>
                                <div class="text-xs text-gray-500" th:text="${a.phone}">0123456789</div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700" th:text="${a.region}">Hà Nội</td>
                            <td class="px-6 py-4 text-sm text-gray-700" th:text="${a.experienceYears}">3</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                <span th:if="${a.status.name() == 'PENDING'}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  <i class="fas fa-clock mr-1"></i>PENDING
                </span>
                                <span th:if="${a.status.name() == 'APPROVED'}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <i class="fas fa-check mr-1"></i>APPROVED
                </span>
                                <span th:if="${a.status.name() == 'REJECTED'}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  <i class="fas fa-ban mr-1"></i>REJECTED
                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                <div th:text="${a.createdAt != null ? #temporals.format(a.createdAt, 'dd/MM/yyyy') : 'N/A'}">01/01/2025</div>
                                <div class="text-xs text-gray-400" th:text="${a.createdAt != null ? #temporals.format(a.createdAt, 'HH:mm') : ''}">10:30</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex items-center space-x-2">
                                    <!-- APPROVE -->
                                    <form th:action="@{/admin/vendor-applications/{id}/approve(id=${a.id})}" method="post" class="inline">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <button type="submit"
                                                th:disabled="${a.status.name() != 'PENDING'}"
                                                class="inline-flex items-center px-3 py-1 rounded-lg transition-colors"
                                                th:classappend="${a.status.name() == 'PENDING'} ? 'bg-green-100 hover:bg-green-200 text-green-700' : 'bg-gray-100 text-gray-400 cursor-not-allowed'">
                                            <i class="fas fa-check mr-1"></i>
                                        </button>
                                    </form>
                                    <!-- REJECT -->
                                    <form th:action="@{/admin/vendor-applications/{id}/reject(id=${a.id})}" method="post" class="inline">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <button type="submit"
                                                th:disabled="${a.status.name() != 'PENDING'}"
                                                class="inline-flex items-center px-3 py-1 rounded-lg transition-colors"
                                                th:classappend="${a.status.name() == 'PENDING'} ? 'bg-yellow-100 hover:bg-yellow-200 text-yellow-700' : 'bg-gray-100 text-gray-400 cursor-not-allowed'">
                                            <i class="fas fa-xmark mr-1"></i>
                                        </button>
                                    </form>
                                    <!-- DELETE -->
                                    <form th:action="@{/admin/vendor-applications/{id}/delete(id=${a.id})}" method="post" class="inline" onsubmit="return confirm('Xóa đơn này?');">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <button type="submit"
                                                class="inline-flex items-center px-3 py-1 rounded-lg bg-red-100 hover:bg-red-200 text-red-700 transition-colors">
                                            <i class="fas fa-trash mr-1"></i>Xóa
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="flex items-center justify-between px-6 py-4 bg-white border-t border-gray-200">
                    <div class="text-sm text-gray-600">
                        Trang <span th:text="${page + 1}">1</span>/<span th:text="${totalPages}">1</span>
                    </div>
                    <div class="space-x-2">
                        <a th:href="@{/admin/vendor-applications(page=${page-1}, size=${size}, status=${statusFilter})}"
                           th:classappend="${page <= 0} ? 'pointer-events-none opacity-50' : ''"
                           class="px-4 py-2 border rounded-lg">Trước</a>
                        <a th:href="@{/admin/vendor-applications(page=${page+1}, size=${size}, status=${statusFilter})}"
                           th:classappend="${page + 1 >= totalPages} ? 'pointer-events-none opacity-50' : ''"
                           class="px-4 py-2 border rounded-lg">Sau</a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <div th:replace="/admin/fragments/footer :: footer"></div>
    </div>
</div>

<!-- Active nav item -->
<script>
    const el = document.getElementById('nav-vendor-apps');
    if (el) el.classList.add('bg-gray-700','text-white');
</script>
</body>
</html>
