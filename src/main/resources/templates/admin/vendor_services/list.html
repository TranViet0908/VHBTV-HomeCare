<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gói dịch vụ Vendor - VHBTV Homecare</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
<div class="flex">
  <div th:replace="/admin/fragments/sidebar :: sidebar"></div>

  <div class="flex-1 min-h-screen ml-64">
    <div th:replace="/admin/fragments/header :: header"></div>

    <main class="p-6">
      <div class="mb-6 flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Gói dịch vụ vendor</h1>
          <p class="text-gray-600">Quản lý gói dịch vụ do nhà cung cấp tạo</p>
        </div>
        <div class="flex items-center space-x-3">
          <a th:href="@{/admin/vendor-services/create}" class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
            <i class="fa fa-plus mr-2"></i>Tạo gói mới
          </a>
        </div>
      </div>

      <div th:if="${success}" class="mb-4 p-3 rounded bg-green-50 text-green-800" th:text="${success}"></div>
      <div th:if="${error}" class="mb-4 p-3 rounded bg-red-50 text-red-800" th:text="${error}"></div>

      <div class="bg-white rounded-xl border p-4 mb-4">
        <form method="get" th:action="@{/admin/vendor-services}" class="grid lg:grid-cols-6 md:grid-cols-3 grid-cols-1 gap-3">
          <input type="text" name="kw" th:value="${kw}" placeholder="Tìm tiêu đề/mô tả"
                 class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 lg:col-span-2">
          <select name="vendorId" class="px-3 py-2 border rounded-lg">
            <option th:value="${null}" th:selected="${vendorId == null}">-- Tất cả vendor --</option>
            <option th:each="v : ${vendors}"
                    th:value="${v.user.id}"
                    th:selected="${vendorId != null and vendorId == v.user.id}"
                    th:text="${v.displayName != null ? v.displayName : (v.legalName != null ? v.legalName : 'User #' + v.user.id)}">
            </option>
          </select>
          <select name="serviceId" class="px-3 py-2 border rounded-lg">
            <option th:value="${null}" th:selected="${serviceId == null}">-- Tất cả dịch vụ --</option>
            <option th:each="s : ${services}"
                    th:value="${s.id}"
                    th:selected="${serviceId != null and serviceId == s.id}"
                    th:text="${s.name}">
            </option>
          </select>
          <select name="status" class="px-3 py-2 border rounded-lg">
            <option th:value="${null}" th:selected="${status == null}">-- Trạng thái --</option>
            <option th:selected="${status == 'ACTIVE'}" value="ACTIVE">ACTIVE</option>
            <option th:selected="${status == 'HIDDEN'}" value="HIDDEN">HIDDEN</option>
            <option th:selected="${status == 'PAUSED'}" value="PAUSED">PAUSED</option>
          </select>
          <div class="flex gap-2">
            <input type="number" step="0.01" min="0" name="minPrice" th:value="${minPrice}" placeholder="Giá từ"
                   class="px-3 py-2 border rounded-lg w-full">
            <input type="number" step="0.01" min="0" name="maxPrice" th:value="${maxPrice}" placeholder="đến"
                   class="px-3 py-2 border rounded-lg w-full">
          </div>
          <button class="px-4 py-2 bg-blue-600 text-white rounded-lg">Lọc</button>
        </form>
      </div>

      <div class="bg-white rounded-xl border overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">ID</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Vendor</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Dịch vụ</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Tiêu đề</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Giá</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Đơn vị</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Thời lượng</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Trạng thái</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Cập nhật</th>
              <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">Thao tác</th>
            </tr>
            </thead>
            <tbody class="divide-y" th:if="${page != null}">
            <tr th:each="it : ${page.content}" class="hover:bg-gray-50">
              <td class="px-6 py-3 text-sm" th:text="${it.id}">1</td>
              <td class="px-6 py-3 text-sm"
                  th:text="${vendorNames[it.vendorId] != null ? vendorNames[it.vendorId] : 'User #' + it.vendorId}">Vendor</td>
              <td class="px-6 py-3 text-sm"
                  th:text="${serviceNames[it.serviceId] != null ? serviceNames[it.serviceId] : 'Service #' + it.serviceId}">Service</td>
              <td class="px-6 py-3 text-sm" th:text="${it.title}">Vệ sinh căn hộ 2h</td>
              <td class="px-6 py-3 text-sm"
                  th:text="${#numbers.formatDecimal(it.basePrice, 0, 'POINT', 2, 'COMMA')}">150000</td>
              <td class="px-6 py-3 text-sm" th:text="${it.unit}">giờ</td>
              <td class="px-6 py-3 text-sm" th:text="${it.durationMinutes + ' phút'}">120 phút</td>
              <td class="px-6 py-3 text-sm">
                <span th:classappend="${it.status=='ACTIVE'?'bg-green-100 text-green-700':(it.status=='PAUSED'?'bg-yellow-100 text-yellow-700':'bg-gray-200 text-gray-700')}"
                      class="text-xs px-2 py-0.5 rounded-full"
                      th:text="${it.status}">ACTIVE</span>
              </td>
              <td class="px-6 py-3 text-sm" th:text="${#temporals.format(it.updatedAt, 'dd/MM/yyyy HH:mm')}">--</td>
              <td class="px-6 py-3 text-sm">
                <div class="flex items-center gap-2">
                  <!-- Nút mới: Xem chi tiết -->
                  <a th:href="@{'/admin/vendor-services/' + ${it.id}}"
                     class="px-3 py-1 border rounded">Chi tiết</a>

                  <a th:href="@{'/admin/vendor-services/' + ${it.id} + '/edit'}"
                     class="px-3 py-1 bg-blue-100 text-blue-700 rounded">Sửa</a>

                  <form th:action="@{'/admin/vendor-services/' + ${it.id} + '/status'}" method="post" class="inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <select name="status" class="px-2 py-1 border rounded">
                      <option th:selected="${it.status=='ACTIVE'}" value="ACTIVE">ACTIVE</option>
                      <option th:selected="${it.status=='HIDDEN'}" value="HIDDEN">HIDDEN</option>
                      <option th:selected="${it.status=='PAUSED'}" value="PAUSED">PAUSED</option>
                    </select>
                    <button class="px-2 py-1 border rounded">Áp dụng</button>
                  </form>

                  <form th:action="@{'/admin/vendor-services/' + ${it.id} + '/delete'}"
                        method="post" class="inline"
                        onsubmit="return confirm('Xóa gói này?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="px-3 py-1 bg-red-100 text-red-700 rounded" type="submit">Xóa</button>
                  </form>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="p-4 border-t flex items-center justify-between" th:if="${page != null}">
          <div class="text-sm text-gray-600">
            Trang <span th:text="${page.number + 1}">1</span>/<span th:text="${page.totalPages}">1</span>
          </div>
          <div class="space-x-2">
            <a th:if="${page.hasPrevious()}"
               th:href="@{/admin/vendor-services(page=${page.number - 1}, size=${page.size}, kw=${kw}, vendorId=${vendorId}, serviceId=${serviceId}, status=${status}, minPrice=${minPrice}, maxPrice=${maxPrice})}"
               class="px-3 py-1 border rounded">Trước</a>
            <a th:if="${page.hasNext()}"
               th:href="@{/admin/vendor-services(page=${page.number + 1}, size=${page.size}, kw=${kw}, vendorId=${vendorId}, serviceId=${serviceId}, status=${status}, minPrice=${minPrice}, maxPrice=${maxPrice})}"
               class="px-3 py-1 border rounded">Sau</a>
          </div>
        </div>
      </div>
    </main>

    <div th:replace="/admin/fragments/footer :: footer"></div>
  </div>
</div>
</body>
</html>
