<!-- templates/vendor/orders/detail.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"><title>Chi tiết đơn</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
<th:block th:replace="vendor/layouts/header :: vendorHeader"></th:block>
<div class="flex">
  <th:block th:replace="vendor/layouts/sidebar :: vendorSidebar"></th:block>

  <main class="flex-1 p-6">
    <div th:if="${ok}"  class="mb-3 text-green-700 bg-green-50 border border-green-200 px-3 py-2 rounded" th:text="${ok}"></div>
    <div th:if="${err}" class="mb-3 text-red-700 bg-red-50   border border-red-200  px-3 py-2 rounded" th:text="${err}"></div>

    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-bold">Đơn <span th:text="${order.orderCode}">SO-XXXX</span></h1>
      <a th:href="@{/vendor/orders}" class="text-sm text-blue-600 hover:underline">← Danh sách</a>
    </div>

    <div class="grid md:grid-cols-3 gap-6">
      <section class="md:col-span-2 bg-white rounded-xl shadow p-5">
        <h2 class="font-semibold mb-3">Thông tin</h2>
        <div class="grid grid-cols-2 gap-3 text-sm">
          <div><span class="text-gray-500">Khách:</span> <span th:text="${order.contactName}">...</span></div>
          <div><span class="text-gray-500">SĐT:</span> <span th:text="${order.contactPhone}">...</span></div>
          <div class="col-span-2"><span class="text-gray-500">Địa chỉ:</span> <span th:text="${order.addressLine}">...</span></div>
          <div><span class="text-gray-500">Tạo lúc:</span> <span th:text="${#temporals.format(order.createdAt,'dd/MM/yyyy HH:mm')}">...</span></div>
          <div><span class="text-gray-500">Trạng thái:</span> <span th:text="${order.status}">...</span></div>
          <div><span class="text-gray-500">Tổng:</span> <span class="font-semibold text-green-600" th:text="${#numbers.formatDecimal(order.total,0,'DEFAULT',0,'DEFAULT')}">0</span></div>
        </div>

        <h2 class="font-semibold mt-6 mb-3">Hạng mục</h2>
        <div class="border rounded-xl overflow-hidden">
          <table class="min-w-full">
            <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs text-gray-500 uppercase">Dịch vụ</th>
              <th class="px-4 py-2 text-left text-xs text-gray-500 uppercase">Lịch hẹn</th>
              <th class="px-4 py-2 text-right text-xs text-gray-500 uppercase">SL</th>
              <th class="px-4 py-2 text-right text-xs text-gray-500 uppercase">Đơn giá</th>
              <th class="px-4 py-2 text-right text-xs text-gray-500 uppercase">Thành tiền</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="it : ${items}" class="border-t">
              <td class="px-4 py-2" th:text="${it.vendorService.title}">Tên DV</td>
              <td class="px-4 py-2" th:text="${#temporals.format(it.scheduledAt,'dd/MM/yyyy HH:mm')}">...</td>
              <td class="px-4 py-2 text-right" th:text="${it.quantity}">1</td>
              <td class="px-4 py-2 text-right" th:text="${#numbers.formatDecimal(it.unitPrice,0,'DEFAULT',0,'DEFAULT')}">0</td>
              <td class="px-4 py-2 text-right font-semibold" th:text="${#numbers.formatDecimal(it.subtotal,0,'DEFAULT',0,'DEFAULT')}">0</td>
            </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="bg-white rounded-xl shadow p-5">
        <h2 class="font-semibold mb-3">Thao tác</h2>
        <form th:action="@{|/vendor/orders/${order.id}/action/confirm|}" method="post" class="mb-2">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button class="w-full px-4 py-2 rounded bg-blue-600 text-white" type="submit">Xác nhận</button>
        </form>
        <form th:action="@{|/vendor/orders/${order.id}/action/start|}" method="post" class="mb-2">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button class="w-full px-4 py-2 rounded bg-indigo-600 text-white" type="submit">Bắt đầu</button>
        </form>
        <form th:action="@{|/vendor/orders/${order.id}/action/complete|}" method="post" class="mb-2">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button class="w-full px-4 py-2 rounded bg-green-600 text-white" type="submit">Hoàn thành</button>
        </form>
        <form th:action="@{|/vendor/orders/${order.id}/action/cancel|}" method="post" class="mb-2">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button class="w-full px-4 py-2 rounded bg-red-600 text-white" type="submit">Hủy đơn</button>
        </form>
        <p class="text-xs text-gray-500 mt-3">PENDING→CONFIRMED→IN_PROGRESS→COMPLETED. Có thể hủy trừ khi đã hoàn thành.</p>
      </section>
    </div>
  </main>
</div>
</body>
</html>
